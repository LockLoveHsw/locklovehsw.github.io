<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Linux 用户管理 · Sway's Blog</title><meta name="description" content="Linux 用户管理 - Sway Hong"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://locklovehsw.github.io/atom.xml" title="Sway's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/locklovehsw" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Linux 用户管理</h1><div class="post-info">Feb 15, 2017</div><div class="post-content"><p>本文主要目的：关闭 root 登录，加强服务器安全</p><a id="more"></a><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>管理 Linux 服务器的时候，通常不采用 root 进行远程登录。</p><p>原因很显然，就是安全。</p><p>如果你维护过 Linux 服务器，可以在 <code>/var/log/auth.log</code> 里查看到和下图显示相似的内容。</p><p><strong>都是被尝试登录的铁证</strong></p><p><img src="/uploads/auth_log.png" alt="auth_log"></p><blockquote><ul><li><code>last</code> 查看最近几次登录的记录</li><li><code>lastb</code> 查看登入系统失败的记录</li></ul></blockquote><h2 id="措施"><a href="#措施" class="headerlink" title="措施"></a>措施</h2><p>为什么要禁止 <code>root</code> 或者其他常见的用户名登录呢？</p><p>因为太好猜了，如果自己攻击他人的服务器，想到的名字一定是 root / admin / www 这些常用的用户名，密码也会猜 123456 / admin / password 这类很有诟病的简单密码。</p><p>那如果需要禁止 root 登录，首先得先创建另一个用户名作为登录，不然禁止 <code>root</code> 远程登录后，重启 sshd 服务后，自己可能就傻眼了，再也登入不了。因为唯一的大门被禁止进入了，只能跑到主机面前，跪下叩拜机神了。</p><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">root@ubuntu:~ <span class="comment"># adduser locklovehsw</span></div><div class="line">Adding user <span class="string">'locklovehsw'</span> ...</div><div class="line">Adding new group <span class="string">'locklovehsw'</span> (1000) ...</div><div class="line">Adding new user <span class="string">'locklovehsw'</span> (1000) with group <span class="string">'locklovehsw'</span> ...</div><div class="line">The home directory <span class="string">'/home/locklovehsw'</span> already exists.  Not copying from <span class="string">'/etc/skel'</span>.</div><div class="line">Enter new UNIX password:</div><div class="line">Retype new UNIX password:</div><div class="line">passwd: password updated successfully</div><div class="line">Changing the user information <span class="keyword">for</span> locklovehsw</div><div class="line">Enter the new value, or press ENTER <span class="keyword">for</span> the default</div><div class="line">	Full Name []:</div><div class="line">	Room Number []:</div><div class="line">	Work Phone []:</div><div class="line">	Home Phone []:</div><div class="line">	Other []:</div><div class="line">Is the information correct? [Y/n] Y</div><div class="line"></div><div class="line">root@ubuntu:~ <span class="comment"># su locklovehsw</span></div><div class="line"></div><div class="line">locklovehsw@ubuntu:/root $ sudo ls</div><div class="line">[sudo] password <span class="keyword">for</span> locklovehsw:</div><div class="line">locklovehsw is not <span class="keyword">in</span> the sudoers file.  This incident will be reported.</div></pre></td></tr></table></figure><h3 id="添加至-sudo-用户组"><a href="#添加至-sudo-用户组" class="headerlink" title="添加至 sudo 用户组"></a>添加至 sudo 用户组</h3><p>创建的用户不具有使用 <code>sudo</code> 的权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">root@ubuntu:~ <span class="comment"># adduser locklovehsw sudo</span></div><div class="line">Adding user <span class="string">'locklovehsw'</span> to group <span class="string">'sudo'</span> ...</div><div class="line">Adding user locklovehsw to group sudo</div><div class="line">Done.</div></pre></td></tr></table></figure><h3 id="禁止-root-远程登录"><a href="#禁止-root-远程登录" class="headerlink" title="禁止 root 远程登录"></a>禁止 root 远程登录</h3><p>修改 <code>/etc/ssh/sshd_config</code> 配置文件，将 <code>PermitRootLogin</code> 修改为 <code>no</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 禁止 root 远程登录</span></div><div class="line">PermitRootLogin no</div></pre></td></tr></table></figure><h3 id="重启-ssh-服务"><a href="#重启-ssh-服务" class="headerlink" title="重启 ssh 服务"></a>重启 ssh 服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root@ubuntu:~ <span class="comment"># service ssh restart</span></div></pre></td></tr></table></figure><h3 id="退出服务器"><a href="#退出服务器" class="headerlink" title="退出服务器"></a>退出服务器</h3><p>尝试以 <code>root</code> 登录，发现正确的密码也无法登录</p></div></article></div></main><footer><div class="paginator"><a href="/20170217/best-tools.html" class="prev">PREV</a><a href="/20170210/hexo-on-macOS.html" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname="locklovehsw",disqus_identifier="20170215/linux-user.html",disqus_title="Linux 用户管理",disqus_url="https://locklovehsw.github.io/20170215/linux-user.html";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script id="dsq-count-scr" src="//locklovehsw.disqus.com/count.js" async></script><div class="copyright"><p>© 2017 <a href="https://locklovehsw.github.io">Sway Hong</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>!function(e,t,a,n,c,o){e.GoogleAnalyticsObject=n,e[n]||(e[n]=function(){(e[n].q=e[n].q||[]).push(arguments)}),e[n].l=+new Date,c=t.createElement(a),o=t.getElementsByTagName(a)[0],c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script","ga"),ga("create","UA-65933410-1","auto"),ga("send","pageview")</script></body></html>